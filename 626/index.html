<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ›¼å¾·æ‹‰è‰è¾²å ´</title>
    
    <!-- å°åŒ—é»‘é«”å­—é«” -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/taipei-sans-tc@1.0.0/dist/Light/TaipeiSansTCBeta-Light.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/taipei-sans-tc@1.0.0/dist/Regular/TaipeiSansTCBeta-Regular.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/taipei-sans-tc@1.0.0/dist/Bold/TaipeiSansTCBeta-Bold.css">
    
    <!-- CSSæª”æ¡ˆ -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    
</head>
<body>
    <div class="game-container">
        <!-- å·¦å´é¢æ¿ -->
        <div class="left-panel">
            <!-- éŠæˆ²æ¨™é¡Œ -->
            <h1 class="game-title">ğŸŒ± æ›¼å¾·æ‹‰è‰è¾²å ´ ğŸŒ±</h1>
            
            <!-- ä¸»è¦è³‡æºé¡¯ç¤º -->
            <div class="main-resources">
                <div class="resource-combined">
                    <div class="fruit-section">
                        <div class="resource-label">ç•¶å‰æœå¯¦</div>
                        <div class="resource-value" id="fruit">100</div>
                        <div class="production-label">æ¯ç§’ç”¢é‡</div>
                        <div class="production-value" id="production-rate">0</div>
                    </div>
                </div>
            </div>
            
            <!-- è³¼è²·å€åŸŸ -->
            <div class="purchase-section">
                <!-- æ‰¹é‡è³¼è²·æ§åˆ¶ -->
                <div class="bulk-buy-controls">
                    <span class="bulk-label">æ‰¹é‡è³¼è²·ï¼š</span>
                    <div class="bulk-buttons">
                        <button class="bulk-btn active" data-amount="1">1å€‹</button>
                        <button class="bulk-btn" data-amount="10">10å€‹</button>
                        <button class="bulk-btn" data-amount="100">100å€‹</button>
                        <button class="store-btn" onclick="openStore()">ğŸ›’ å•†åº—</button>
                    </div>
                </div>
                
                <div class="mandrake-list" id="mandrake-list">
                    <!-- æ›¼å¾·æ‹‰è‰é …ç›®æœƒå‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- åº•éƒ¨ç³»çµ±å€åŸŸ -->
            <div class="bottom-systems">
                <!-- å¤©è³¦é»é¡¯ç¤º -->
                <div class="talent-points-section">
                    <h4>â­ å¤©è³¦é»æ•¸</h4>
                    <div>
                        <span class="resource-value" id="talent-points">0</span>
                        <div class="resource-label">ç´¯ç©å¤©è³¦é»æ•¸</div>
                    </div>
                </div>
                
                <!-- é‡ç”Ÿç³»çµ± -->
                <div class="rebirth-section">
                    <h4>ğŸ”„ é‡ç”Ÿç³»çµ±</h4>
                    <p>é‡ç”Ÿå¯ç²å¾—å¤©è³¦é»ï¼Œç”¨æ–¼æ°¸ä¹…æå‡ï¼</p>
                    <div class="rebirth-info">
                        é è¨ˆç²å¾—ï¼š<span class="rebirth-points" id="rebirth-points">0</span> å¤©è³¦é»
                    </div>
                    <button class="rebirth-btn" onclick="rebirth()">é‡ç”Ÿ</button>
                </div>
            </div>
        </div>
        
        <!-- å³å´é¢æ¿ -->
        <div class="right-panel">
            <!-- ä¸Šæ–¹æ©«å¹… -->
            <div class="top-bar">
                <!-- çå‹µé ˜å–å€ -->
                <div class="reward-section reward-info-container">
                    <!-- ğŸ”§ æ–°å¢ï¼šçå‹µæ•¸é‡è¡Œ -->
                    <div class="reward-count-row">
                        <div class="reward-count">
                            ğŸ å¯é ˜å–çå‹µï¼š<span class="pending-count" id="pending-rewards">0</span>/<span id="max-rewards">2</span>
                        </div>
                    </div>
                    
                    <!-- ğŸ”§ æ–°å¢ï¼šæŒ‰éˆ•å’Œå€’æ•¸è¡Œ -->
                    <div class="reward-button-row">
                        <button class="claim-reward-btn" id="claim-reward-btn" onclick="openRewardSelection()">
                            é ˜å–çå‹µ
                        </button>
                        <div class="reward-timer">
                            ä¸‹æ¬¡çå‹µï¼š<span class="countdown" id="reward-countdown">30:00</span>
                        </div>
                    </div>
                </div>
                
                <!-- ä¸­é–“è¼ªæ’­å€ -->
                <div class="carousel-text-section">
                    <div class="carousel-text-container">
                        <span id="carousel-text">æ­¡è¿ä¾†åˆ°æ›¼å¾·æ‹‰è‰è¾²å ´ï¼</span>
                    </div>
                </div>
                
                <!-- ç³»çµ±æŒ‰éˆ•å€ -->
                <div class="system-buttons">
                    <div class="button-row">
                        <button class="system-btn" onclick="showStats()">ğŸ“Š çµ±è¨ˆ</button>
                        <button class="system-btn" onclick="showEncyclopedia()">ğŸ“– åœ–é‘‘</button>
                    </div>
                    <div class="button-row">
                        <button class="system-btn enhancement-btn" id="enhancement-btn" onclick="openEnhancementSelection()" disabled>
                            ğŸ”® å¼·åŒ–
                        </button>
                        <button class="system-btn announcement-btn" id="announcement-btn" onclick="showAnnouncement()">
                            ğŸ“¢ å…¬å‘Š
                            <span class="announcement-badge" id="announcement-badge" style="display: none;">0</span>
                            
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- ä¸»è¦éŠæˆ²å€åŸŸ -->
            <div class="main-game-area">
                <!-- å¤©æ°£é¡¯ç¤º -->
                <div class="weather-display-container">
                    <div class="weather-name-diamond">
                        <span id="current-weather-name">æš´é›¨</span>
                    </div>
                    <div class="weather-right-section">
                        <div class="weather-timer-section">
                            ä¸‹æ¬¡åˆ·æ–°ï¼š<span id="weather-refresh-timer">04:23</span>
                        </div>
                        <div class="weather-effect-box">
                            <div class="weather-effect-content">
                                <div class="weather-effect-text">
                                    <span id="weather-effect-desc">å‹•ç‰©ç³»æš«åœ, æ™®é€šç³» +30%</span>
                                </div>
                                <button class="weather-reroll-btn" onclick="rerollWeather()">
                                    é‡éª° <span id="weather-cost">100</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- å¼·åŒ–å±•ç¤ºå€åŸŸ (æ·»åŠ åˆ°å¤©æ°£é¡¯ç¤ºä¸‹æ–¹) -->
                <div class="enhancement-summary" id="enhancementSummary">
                    <div class="enhancement-toggle" onclick="toggleEnhancementDisplay()">
                        <div class="enhancement-icon-main">ğŸ”®</div>
                        <div class="enhancement-count" id="enhancementTotalCount">0</div>
                    </div>
                    
                    <div class="enhancement-expanded" id="enhancementExpanded" style="display: none;">
                        <div class="enhancement-grid" id="enhancementDetailGrid">
                            <!-- å€‹åˆ¥å¼·åŒ–æ–¹å¡Šæœƒå‹•æ…‹ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>
                
                <!-- æ›¼å¾·æ‹‰è‰åœ–ç‰‡ -->
                <div class="mandrake-display">
                    <img src="images/mandrake_himself.png" alt="æ›¼å¾·æ‹‰è‰" class="mandrake-image" id="main-mandrake" onmousedown="clickMandrake()" ontouchstart="clickMandrake()">
                </div>
            </div>
        </div>
    </div>

    <!-- çµ±è¨ˆæ¨¡æ…‹æ¡† -->
    <div id="stats-modal" class="modal-overlay">
        <div class="modal-content stats-modal">
            <div class="modal-header">
                <h3>ğŸ“Š éŠæˆ²çµ±è¨ˆ</h3>
                <button onclick="hideStats()" class="stats-close-btn">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="stats-content">
                    <!-- çµ±è¨ˆå…§å®¹å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- åœ–é‘‘æ¨¡æ…‹æ¡† -->
    <div id="encyclopedia-modal" class="modal-overlay">
        <div class="modal-content encyclopedia-modal">
            <div class="modal-header">
                <h3>ğŸ“– æ›¼å¾·æ‹‰è‰åœ–é‘‘</h3>
                <button onclick="hideEncyclopedia()" class="encyclopedia-close-btn">Ã—</button>
            </div>
            <div class="modal-body">
                <div id="encyclopedia-content" class="encyclopedia-content">
                    <!-- åœ–é‘‘å…§å®¹å°‡ç”± JavaScript ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- çå‹µé¸æ“‡å½ˆçª— -->
    <div class="modal-overlay" id="reward-modal">
        <div class="modal-content reward-modal-content">
            <div class="modal-header">
                <h3>ğŸ é¸æ“‡ä½ çš„çå‹µï¼</h3>
            </div>
            <div class="reward-options" id="reward-options">
                <!-- çå‹µé¸é …æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- å•†åº—æ¨¡æ…‹æ¡† -->
    <div class="modal-overlay" id="store-modal">
        <div class="modal-content store-modal-content">
            <div class="modal-header">
                <h3>ğŸ›’ å•†åº—</h3>
                <button onclick="closeStore()" class="stats-close-btn">Ã—</button>
            </div>
            <div class="modal-body" id="store-content">
                <!-- å•†åº—å…§å®¹æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- å¼·åŒ–é¸æ“‡å½ˆçª— -->
    <div class="modal-overlay" id="enhancement-modal">
        <div class="modal-content enhancement-modal-content">
            <div class="modal-header">
                <h3>ğŸ”® é¸æ“‡ä½ çš„å¼·åŒ–ï¼</h3>
                <p class="enhancement-milestone" id="enhancement-milestone">é”æˆé‡Œç¨‹ç¢‘ï¼šä»»æ„æ›¼å¾·æ‹‰è‰é”åˆ° 100 æ ª</p>
            </div>
            <div class="enhancement-options" id="enhancement-options">
                <!-- å¼·åŒ–é¸é …æœƒå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>
    </div>

     <!-- å…¬å‘Šæ¨¡æ…‹æ¡† -->
    <div id="announcement-modal" class="modal-overlay">
        <div class="announcement-modal">
            <div class="announcement-header">
                <h3>ğŸ“¢ æ›´æ–°å…¬å‘Š</h3>
                <button onclick="hideAnnouncement()" class="announcement-close-btn">Ã—</button>
            </div>
            <div class="announcement-content">
                <div class="version-list" id="announcement-version-list">
                    <!-- ç‰ˆæœ¬æ›´æ–°åˆ—è¡¨æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥è¨Šæ¯å®¹å™¨ -->
    <div class="notification-container" id="notification-container">
        <!-- é€šçŸ¥è¨Šæ¯æœƒå‹•æ…‹ç”Ÿæˆ -->
    </div>

    <!-- JavaScript æª”æ¡ˆ -->
    <script src="js/config.js"></script>
    <script src="js/imageManager.js"></script>
    <script src="js/game.js"></script>
    <script src="js/rewards.js"></script>
    <script src="js/enhancement.js"></script>
    <script src="js/enhancementDisplay.js"></script>
    <script src="js/store.js"></script> 
    <script src="js/ui.js"></script>
    <script src="js/carousel.js"></script>  
    <script src="js/main.js"></script>
    <script src="js/encyclopedia.js"></script>
    <script src="js/announcement.js"></script>
    <script>
        console.log('HTML å·²è¼‰å…¥');
        window.addEventListener('DOMContentLoaded', () => {
            console.log('DOM è¼‰å…¥å®Œæˆ');
            
            // æª¢æŸ¥å„å€‹ JS æ–‡ä»¶æ˜¯å¦è¼‰å…¥
            console.log('GAME_CONFIG å­˜åœ¨:', typeof GAME_CONFIG !== 'undefined');
            console.log('game ç‰©ä»¶å­˜åœ¨:', typeof game !== 'undefined');
            console.log('UI é¡å­˜åœ¨:', typeof UI !== 'undefined');
            
            // æª¢æŸ¥ HTML å…ƒç´ 
            console.log('mandrake-list å…ƒç´ å­˜åœ¨:', !!document.getElementById('mandrake-list'));
            console.log('carousel-text å…ƒç´ å­˜åœ¨:', !!document.getElementById('carousel-text'));
            
            // åˆå§‹åŒ–è¼ªæ’­ç³»çµ±ï¼ˆä½¿ç”¨åŸæœ‰çš„ carousel.jsï¼‰
            if (typeof initCarousel === 'function') {
                console.log('ğŸš€ åˆå§‹åŒ–è¼ªæ’­ç³»çµ±');
                initCarousel();
            } else {
                console.log('âš ï¸ initCarousel å‡½æ•¸ä¸å­˜åœ¨ï¼Œç­‰å¾…è¼‰å…¥...');
                // å»¶é²åˆå§‹åŒ–ï¼Œç­‰å¾… carousel.js è¼‰å…¥
                setTimeout(() => {
                    if (typeof initCarousel === 'function') {
                        console.log('ğŸš€ å»¶é²åˆå§‹åŒ–è¼ªæ’­ç³»çµ±');
                        initCarousel();
                    }
                }, 1000);
            }
                   
            // å•Ÿå‹•å„ªåŒ–çš„éŠæˆ²å¾ªç’°
            setTimeout(() => {
                if (window.optimizedGameLoop) {
                    console.log('ğŸš€ å•Ÿå‹•å„ªåŒ–éŠæˆ²å¾ªç’°');
                    requestAnimationFrame(window.optimizedGameLoop);
                }
            }, 1000);
        });

        // å¼·åŒ–é¸æ“‡å‡½æ•¸
        window.openEnhancementSelection = function() {
            if (!game.data.enhancements.pendingEnhancement || game.data.enhancements.pendingCount <= 0) {
                UI.showNotification('ç›®å‰æ²’æœ‰å¯ç”¨çš„å¼·åŒ–', 'warning');
                return;
            }
            
            if (typeof EnhancementSystem !== 'undefined') {
                if (!game.data.enhancements.currentChoices || game.data.enhancements.currentChoices.length === 0) {
                    EnhancementSystem.triggerEnhancementChoice();
                } else {
                    UI.showEnhancementChoice();
                }
            }
        };

        // é»æ“Šæ›¼å¾·æ‹‰è‰åŠŸèƒ½
        function clickMandrake() {
            // å‘¼å«éŠæˆ²çš„é»æ“Šæ–¹æ³•
            if (game && game.clickMandrake) {
                game.clickMandrake();
            }
            
            // ğŸ”§ æ–°å¢ï¼šé»æ“Šæ™‚åœŸå£¤éœ‡å‹•æ•ˆæœ
            const mandrakeDisplay = document.querySelector('.mandrake-display');
            if (mandrakeDisplay) {
                mandrakeDisplay.classList.add('clicked');
                setTimeout(() => {
                    mandrakeDisplay.classList.remove('clicked');
                }, 600);
            }
        }

        // ğŸ”§ æ–°å¢ï¼šå…¬å‘Šæ¨¡æ…‹æ¡†äº‹ä»¶è™•ç†
        // é»æ“Šæ¨¡æ…‹æ¡†å¤–éƒ¨é—œé–‰
        const announcementModal = document.getElementById('announcement-modal');
        if (announcementModal) {
            announcementModal.addEventListener('click', function(e) {
                if (e.target === this) {
                    hideAnnouncement();
                }
            });
        }
        
        // ESC éµé—œé–‰å…¬å‘Š
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('announcement-modal');
                if (modal && modal.classList.contains('show')) {
                    hideAnnouncement();
                }
            }
        });
    </script>
</body>
</html>